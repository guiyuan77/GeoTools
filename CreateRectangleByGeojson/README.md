# GeoJSON矩形面批量创建器

## 📋 功能描述

这是一个专门用于批量处理GeoJSON文件并创建矩形面的Python工具。它能够：

- 📁 批量读取指定目录下所有GeoJSON文件（点、线、面、要素集合等）
- 🔍 自动验证所有文件的GeoJSON格式
- 🔲 为每个文件生成对应的矩形面GeoJSON
- 💾 批量保存结果到指定目录
- 📊 显示详细的处理进度和统计信息
- ⚠️ 遇到格式错误文件时立即停止并提示详细信息

## 🚀 快速开始

### 安装依赖

本工具仅使用Python标准库，无需安装额外依赖：

```bash
# 确保Python版本 >= 3.6
python --version
```

### 基本使用

#### 命令行参数格式
```bash
python create_rectangle_from_geojson.py <输入目录> <输出目录>
```

**参数说明：**
- `<输入目录>` - 包含GeoJSON文件的目录绝对路径
- `<输出目录>` - 生成文件的保存目录绝对路径

#### 使用示例

**Windows系统：**
```bash
# 处理C盘data目录下的所有GeoJSON文件
python create_rectangle_from_geojson.py "C:\data\geojson" "C:\output\rectangles"

# 处理当前项目中的原始数据
python create_rectangle_from_geojson.py "D:\workSpace\workCode\中小流域\拉萨气象数据python脚本\原始接口数据" "D:\workSpace\workCode\中小流域\拉萨气象数据python脚本\结果数据文件"
```

**Linux/Mac系统：**
```bash
# 处理用户目录下的数据
python create_rectangle_from_geojson.py "/home/user/data" "/home/user/output"

# 处理项目数据
python create_rectangle_from_geojson.py "/path/to/input" "/path/to/output"
```

## 📁 处理流程

### 1. 文件扫描
程序会扫描输入目录下所有 `.geojson` 和 `.json` 文件

### 2. 格式验证
对每个文件进行严格的GeoJSON格式验证：
- 文件存在性检查
- 文件扩展名验证
- 文件大小检查
- JSON格式解析
- GeoJSON结构验证
- 坐标数据有效性检查

### 3. 批量处理
为每个有效文件：
- 计算边界范围
- 生成四个角点坐标
- 创建矩形面GeoJSON
- 保存到输出目录

### 4. 结果输出
生成的文件命名格式：`原文件名四角边框矩形面.geojson`

## 📊 输出结果

### 处理过程显示
程序会显示详细的处理信息：

```
🔍 正在扫描目录: C:\data\geojson
📁 找到 3 个GeoJSON文件
================================================================================
🔍 正在验证文件格式...
  检查: points.geojson
  ✅ 格式正确
  检查: lines.geojson
  ✅ 格式正确
  检查: polygons.geojson
  ✅ 格式正确

✅ 所有文件验证通过，开始处理...
================================================================================

📄 处理文件: points.geojson
  📍 边界范围: 90.900002° ~ 91.400002° (经度), 29.549999° ~ 29.700001° (纬度)
  🎯 中心点: [91.150002, 29.625000]
  📏 尺寸: 0.500000° × 0.150002°
✅ 已生成: points四角边框矩形面.geojson
```

### 生成文件信息
每个生成的矩形面GeoJSON文件包含：

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [[[min_lon, min_lat], [min_lon, max_lat], [max_lon, max_lat], [max_lon, min_lat], [min_lon, min_lat]]]
      },
      "properties": {
        "name": "原文件名四角边框矩形面",
        "description": "通过原文件名边界数据生成的矩形面",
        "source_file": "原文件名",
        "bounds": {...},
        "center": [center_lon, center_lat],
        "width": width_degrees,
        "height": height_degrees,
        "bbox": [min_lon, min_lat, max_lon, max_lat]
      }
    }
  ]
}
```

## 🔧 支持的GeoJSON格式

| 类型 | 描述 | 支持状态 |
|------|------|----------|
| Point | 点 | ✅ |
| LineString | 线串 | ✅ |
| Polygon | 多边形 | ✅ |
| MultiPoint | 多点 | ✅ |
| MultiLineString | 多线串 | ✅ |
| MultiPolygon | 多多边形 | ✅ |
| Feature | 要素 | ✅ |
| FeatureCollection | 要素集合 | ✅ |

## ⚠️ 错误处理机制

### 文件验证错误
当发现格式错误的文件时，程序会：

1. **立即停止处理**
2. **显示详细错误信息**
3. **列出所有错误文件**
4. **提示用户手动处理**

### 错误信息示例
```
❌ 发现格式错误的文件，程序停止执行
请手动处理以下文件后重新运行程序:
--------------------------------------------------------------------------------
文件: invalid_file.geojson
错误: JSON格式错误: Expecting ',' delimiter - invalid_file.geojson
----------------------------------------
文件: empty_file.geojson
错误: 文件为空: empty_file.geojson
----------------------------------------
```

### 常见错误类型
- **文件不存在**：检查文件路径
- **文件为空**：确保文件包含数据
- **JSON格式错误**：检查JSON语法
- **编码错误**：确保使用UTF-8编码
- **无效GeoJSON类型**：检查type字段
- **缺少坐标数据**：确保包含有效坐标

## 💡 应用场景

### 1. 批量数据处理
- 处理大量GeoJSON文件
- 自动化边界计算
- 批量生成矩形面

### 2. 地图可视化
- 为地图组件批量设置视图范围
- 创建数据边界的外接矩形
- 生成地图覆盖层

### 3. 空间分析
- 批量计算数据的地理分布范围
- 进行空间查询的边界框
- 数据质量检查和验证

### 4. 数据预处理
- 为GIS分析准备边界数据
- 创建缓冲区分析的基础
- 数据裁剪和分割

## 📝 使用注意事项

### 文件格式要求
- 支持 `.geojson` 和 `.json` 文件扩展名
- 文件必须是有效的GeoJSON格式
- 使用UTF-8编码
- 文件不能为空

### 目录要求
- 输入目录必须存在且可读
- 输出目录会自动创建（如果不存在）
- 支持绝对路径和相对路径

### 性能考虑
- 对于大型目录，处理时间可能较长
- 建议单次处理文件数量不超过1000个
- 内存使用量与文件大小成正比

## 🔍 故障排除

### 常见问题

1. **参数错误**
   ```
   ❌ 输入目录不存在: C:\nonexistent\path
   ```
   **解决方案**：检查输入目录路径是否正确

2. **权限问题**
   ```
   ❌ 无法创建输出目录: Permission denied
   ```
   **解决方案**：检查输出目录的写入权限

3. **文件格式错误**
   ```
   ❌ 发现格式错误的文件，程序停止执行
   ```
   **解决方案**：根据错误信息修复文件格式

4. **编码问题**
   ```
   ❌ 文件编码错误，请确保使用UTF-8编码
   ```
   **解决方案**：将文件重新保存为UTF-8编码

## 📚 技术细节

### 算法说明

1. **文件扫描**：使用glob模式匹配查找所有GeoJSON文件
2. **格式验证**：多层次验证确保文件格式正确
3. **坐标提取**：递归遍历GeoJSON结构，提取所有坐标点
4. **边界计算**：计算所有坐标点的最小/最大经纬度
5. **矩形生成**：根据边界生成四个角点坐标
6. **批量保存**：按指定命名规则保存所有结果

### 性能优化

- 使用glob模块高效扫描文件
- 递归算法处理嵌套几何结构
- 单次遍历完成所有坐标提取
- 内存友好的流式处理

## 🤝 贡献指南

欢迎提交问题报告和功能建议！

### 开发环境
- Python 3.6+
- 标准库依赖
- 支持Windows/Linux/macOS

### 代码规范
- 遵循PEP 8编码规范
- 使用类型注解
- 完整的文档字符串
- 中文注释和输出

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 📞 联系方式

如有问题或建议，请通过以下方式联系：

- 提交Issue
- 发送邮件
- 项目讨论区

---

**版本**: 1.0.1  
**更新日期**: 2025年  
**维护者**: liguiyuan 